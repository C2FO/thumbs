/*! thumbs - v0.0.1 - 2012-12-09
* Copyright (c) 2012 Pollenware; Licensed MIT */
(function(){function e(e,t){function s(e){return i.call(e,0)}function h(e,n){return t.each(e.split(o.MULTI_ARG_TOKEN),function(e){n(t.map(e.split(o.KEY_VALUE_TOKEN),function(e){return $.trim(e)}))})}function p(e,t,n){n?"function"==typeof e[n]?e[n](t):e.attr(n,t):e.is("input")?e.is("[type=checkbox], [type=radio]")?e.attr("checked",t):e.val(t):e.text(t)}function m(e,t){var n=v.apply(this,arguments);return n.prototype.__getConstructor=function(){return n},n}function g(e){this.cid=t.uniqueId("class"),this.initialize.apply(this,arguments)}var n=this,r=Array.prototype,i=r.slice,o={};t.extend(o,e),o.VERSION="0.0.1",o.MULTI_ARG_TOKEN=/ +/,o.KEY_VALUE_TOKEN=":";var u=o.Model,a=o.View,f=o.Collection,l=o.Router,c=o.History,d={_super:function(){function t(e,t){var n=t;while(n[e]===t[e]){var r=n.__getConstructor();n=r.__super__}return n}return function(n,r){this._superCallObjects||(this._superCallObjects={});var i=this._superCallObjects[n]||this,s=t(n,i);this._superCallObjects[n]=s;var o=s[n].apply(this,r||{});return delete this._superCallObjects[n],o}}()},v=o.Model.extend;t.extend(g.prototype,o.Events,d,{initialize:function(){}}),o.Class=g,g.extend=u.extend=a.extend=f.extend=l.extend=c.extend=m,u=o.Model=u.extend(d),a=o.View=a.extend(d),f=o.Collection=f.extend(d),l=o.Router=l.extend(d);var y={render:function(){return this._super("render",arguments),this.checkForEvents(),this},checkForEvents:function(){var n=this;return this.events=this.events||{},this.$("[data-thumbs-delegate]").each(function(){var e=$(this),r=t.uniqueId("thumbs_");e.addClass(r),h(e.data("thumbs-delegate"),function(e){var t=e[0],i=e[1];n.events[t+" ."+r]=i})}),this.delegateEvents(),this}},b={__identifiers:null,initialize:function(){this.__identifiers=[],this._super("initialize",arguments)},removeIdentifiers:function(){t.each(this.__identifiers,function(e){this[e]=this["$"+e]=null},this),this.__identifiers=[]},checkForIdentifiers:function(){var t=this;return this.removeIdentifiers(),this.$("[data-thumbs-id]").each(function(e){var n=$(this),r=n.data("thumbs-id");t[r]=this,t["$"+r]=n,t.__identifiers.push(r)}),this},render:function(){return this._super("render",arguments),this.checkForIdentifiers(),this},remove:function(){return this.removeIdentifiers(),this._super("remove",arguments)}},w={__monitors:null,__events:null,initialize:function(){this._super("initialize",arguments),this.__monitors={},this.__events={},t.bindAll(this,"setElData","__updateValues","__setValues","setupType","setupBind","setupClassBind","setupEventBind","findThumbsBind","turnOnModelListeners","turnOffModelListeners","setupBinders")},__updateValues:function(){if(this.model&&this.model instanceof u)return this.__setValues(this.model.changedAttributes())},__setValues:function(n){var r=this.__monitors;return r&&t.each(n,function(n,i){var s=r[i];s&&t.each(s,function(e){e(n)})}),this},setElData:function(t,n,r,i){this.checkFormatting(t,n,r)},setupType:function(t,n,r){var i=this.__monitors;t in i||(i[t]=[]);var s=this.setElData;i[t].push(function(i){"function"==typeof n?n(i,t):s(n,i,r,t)})},setupBind:function(t){var n=$(t),r=this.setupType;h(n.data("thumbs-bind"),function(e){if(e.length===1)r(e[0],t);else{if(e.length!==2)throw new TypeError("Invalid data-thumbs-bind definition");r(e[1],t,e[0])}})},setupClassBind:function(t){var n=$(t),r=this.setupType;h(n.data("thumbs-bind-class"),function(e){if(e.length!==2)throw new TypeError("Invalid data-thumbs-bind-class definition");var t=e[0];r(e[1],function(e){n.toggleClass(t,e)})})},setupEventBind:function(t){var n=this.__events,r=$(t),i=this;h(r.data("thumbs-bind-event"),function(e){if(e.length!==2)throw new TypeError("Invalid data-thumbs-bind-class definition");var t=e[0],r=n[t];r||(r=n[t]=[]),r.push(i[e[1]])})},findThumbsBind:function(){var t=this.setupBind,n=this.setupClassBind,r=this.setupEventBind;return this.$("[data-thumbs-bind]").each(function(){t(this)}),this.$("[data-thumbs-bind-event]").each(function(){r(this)}),this.$("[data-thumbs-bind-class]").each(function(){n(this)}),this.$el.is("[data-thumbs-bind]")&&t(this.el),this.$el.is("[data-thumbs-bind-class]")&&n(this.el),this.$el.is("[data-thumbs-bind-event]")&&r(this.el),this},turnOnModelListeners:function(){var n=this.model||this.collection;if(n){var r=this.__monitors,i=this.__events;r&&t.each(this.__monitors,function(e,r){e.fn=function(r,i){t.each(e,function(e){e.apply(this,[i])},this)},n.on("change:"+r,e.fn,this)}),i&&t.each(this.__events,function(e,r){e.fn=function(){var r=arguments;t.each(e,function(e){e.apply(this,r)},this)},n.on(r,e.fn,this)},this)}return this},turnOffModelListeners:function(){var n=this.model||this.collection;if(n){var r=this.__monitors,i=this.__events;r&&t.each(this.__monitors,function(e,t){n.off("change:"+t,e.fn,this)},this),i&&t.each(this.__events,function(e,t){n.off(t,e.fn,this)},this)}return this},setupBinders:function(){var t=this.model||this.collection;return this.turnOffModelListeners().findThumbsBind().turnOnModelListeners(),t&&this.__setValues(t.attributes),this},render:function(){return this._super("render",arguments),this.setupBinders(),this},remove:function(){return this.turnOffModelListeners(),this.__monitors=this.__events=null,this._super("remove",arguments)}},E={checkFormatting:function(t,n,r){var i=this.$(t),o=s(arguments);n=o.length>1?n:i.text(),n=n!==null&&"undefined"!=typeof n?n:"";var u=i.data("thumbs-format");h(u||"",function(e){e.length===2?(r=e[0],u=e[1]):u=e.pop()}),u&&"function"==typeof this[u]&&(n=this[u](n)),p(i,n,r)},renderFormatters:function(){var n=t.bind(this.checkFormatting,this);return this.$("[data-thumbs-format]").each(function(){n(this)}),this},render:function(){return this._super("render",arguments),this.renderFormatters()}},S={findEl:function(){var e=t.bind(this.setElement,this),n=this.$("[data-thumbs-el]").first().get();return n.length&&(n=n[0],n!==this.el&&e(n)),this},render:function(){return this.findEl()._super("render",arguments)}};return o.templater=function(){var n=t.template;return function(t){return t?n=t:n}}(),o.Router=l.extend({route:function(n,r,i){return this._super("route",arguments),o.history||(o.history=e.history),this}}),a=o.View=a.extend(S).extend(E).extend(b).extend(w).extend(y).extend({_subviews:null,initialize:function(t){this._super("initialize",arguments),this._subviews={}},addSubView:function(t,n){return n&&(this.removeSubView(t),this._subviews[t]=n,n.setElement(this.$(t)).render()),this},removeSubView:function(t){var n=this._subviews[t];return n&&(n.setElement(null),n.remove(),this.$(t).empty(),this._subviews[t]=null),this},removeSubViews:function(){return t.each(this._subviews,function(e,t){this.removeSubView(t)},this),this},render:function(){return this._super("render",arguments),this.assign(this._subviews)},assign:function(n,r){var i;return t.isObject(n)?i=n:n&&(i={},i[n]=r),i&&t.each(i,function(e,t){this.addSubView(t,e)},this),this},remove:function(){return this.undelegateEvents(),this.removeSubViews(),this._super("remove",arguments)}}),o.TemplateView=a.extend({templater:null,template:null,initialize:function(e){this._super("initialize",arguments),this.templater||(this.templater=o.templater()),this.template&&(this._template=this.templater(this.template))},getTemplateData:function(){return this.model?this.model.toJSON():{}},fillTemplate:function(){return this._template?this._template(this.getTemplateData()):null},renderTemplate:function(){if(this._template){var t=this.fillTemplate();t&&this.$el.html(t)}return this},render:function(){return this.renderTemplate()._super("render",arguments)}}),o}"undefined"!=typeof exports?"undefined"!=typeof module&&module.exports&&(module.exports=e(Backbone||require("backbone"),_||require("underscore"))):"function"==typeof define?define(["require"],function(t){return e(t("backbone"),t("underscore"))}):this.thumbs=e(Backbone,_)}).call(this);