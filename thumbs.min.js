/*! thumbs - v0.0.1 - 2012-12-04
* Copyright (c) 2012 Pollenware; Licensed MIT */
(function(){function r(e){return n.call(e,0)}function h(e,t){return s.each(e.split(i.MULTI_ARG_TOKEN),function(e){t(s.map(e.split(i.KEY_VALUE_TOKEN),function(e){return $.trim(e)}))})}function v(e,t){var n=d.apply(this,arguments);return n.prototype.__getConstructor=function(){return n},n}function m(e){this.cid=s.uniqueId("class"),this.initialize.apply(this,arguments)}var e=this,t=Array.prototype,n=t.slice,i={},s=e._;!s&&"undefined"!=typeof require&&(s=require("underscore"));var o=e.Backbone;!o&&"undefined"!=typeof require&&(o=require("underscore")),s.extend(i,o),i.VERSION="0.0.0",i.MULTI_ARG_TOKEN=/ +/,i.KEY_VALUE_TOKEN=":";var u=i.Model,a=i.View,f=i.Collection,l=i.Router,c=i.History,p={_super:function(){function t(e,t){var n=t;while(n[e]===t[e]){var r=n.__getConstructor();n=r.__super__}return n}return function(n,r){this._superCallObjects||(this._superCallObjects={});var i=this._superCallObjects[n]||this,s=t(n,i);this._superCallObjects[n]=s;var o=s[n].apply(this,r||{});return delete this._superCallObjects[n],o}}()},d=i.Model.extend;s.extend(m.prototype,i.Events,p,{initialize:function(){}}),i.Class=m,m.extend=u.extend=a.extend=f.extend=l.extend=c.extend=v,u=i.Model=u.extend(p),a=i.View=a.extend(p),f=i.Collection=f.extend(p),l=i.Router=l.extend(p);var g={render:function(){return this._super("render",arguments),this.checkForEvents(),this},checkForEvents:function(){var t=this;return this.events=this.events||{},this.$("[data-thumbs-delegate]").each(function(){var e=$(this),n=s.uniqueId("thumbs_");e.addClass(n),h(e.data("thumbs-delegate"),function(e){var r=e[0],i=e[1];t.events[r+" ."+n]=i})}),this.delegateEvents(),this}},y={__identifiers:null,initialize:function(){this.__identifiers=[],this._super("initialize",arguments)},render:function(){return this._super("render",arguments),this.checkForIdentifiers(),this},remove:function(){return s.each(this.__identifiers,function(e){this[e]=this["$"+e]=null},this),this.__identifiers=[],this._super("remove",arguments)},checkForIdentifiers:function(){var t=this;return this.$("[data-thumbs-id]").each(function(e){var n=$(this),r=n.data("thumbs-id");t[r]=this,t["$"+r]=n,t.__identifiers.push(r)}),this}},b={__monitors:null,__events:null,initialize:function(){this._super("initialize",arguments),this.__monitors={},this.__events={}},__updateValues:function(){if(this.model&&this.model instanceof u)return this.__setValues(this.model.changedAttributes())},__setValues:function(t){var n=this.__monitors;return n&&s.each(t,function(t,r){var i=n[r];i&&s.each(i,function(e){e(t)})}),this},setElData:function(t,n,r,i){if(this.checkFormatting)this.checkFormatting(t,n,r);else{n=n!==null&&"undefined"!=typeof n?n:"";var s=this.$(t);r?"function"==typeof s[r]?s[r](n):s.attr(r,n):s.is("input")?s.is("[type=checkbox], [type=radio]")?s.attr("checked",n):s.val(n):s.text(n)}},findThumbsBind:function(){function i(e,n,i){e in t||(t[e]=[]),t[e].push(function(s){"function"==typeof n?n(s,e):r(n,s,i,e)})}function o(e){var t=$(e);h(t.data("thumbs-bind"),function(t){if(t.length===1)i(t[0],e);else{if(t.length!==2)throw new TypeError("Invalid data-thumbs-bind definition");i(t[1],e,t[0])}})}function u(e){var t=$(e);h(t.data("thumbs-bind-class"),function(e){if(e.length!==2)throw new TypeError("Invalid data-thumbs-bind-class definition");var n=e[0];i(e[1],function(e){t.toggleClass(n,e)})})}function f(e){var t=$(e);h(t.data("thumbs-bind-event"),function(e){if(e.length!==2)throw new TypeError("Invalid data-thumbs-bind-class definition");var t=e[0],r=n[t];r||(r=n[t]=[]),r.push(a[e[1]])})}var t=this.__monitors,n=this.__events,r=s.bind(this.setElData,this),a=this;return this.$("[data-thumbs-bind]").each(function(){o(this)}),this.$("[data-thumbs-bind-event]").each(function(){f(this)}),this.$("[data-thumbs-bind-class]").each(function(){u(this)}),this.$el.is("[data-thumbs-bind]")&&o(this.el),this.$el.is("[data-thumbs-bind-class]")&&u(this.el),this.$el.is("[data-thumbs-bind-event]")&&f(this.el),this},turnOnModelListeners:function(){var t=this.model||this.collection;return t&&(s.each(this.__monitors,function(e,n){e.fn=function(n,r){s.each(e,function(e){e.apply(this,[r])},this)},t.on("change:"+n,e.fn,this)}),s.each(this.__events,function(e,n){e.fn=function(){var n=arguments;s.each(e,function(e){e.apply(this,n)},this)},t.on(n,e.fn,this)},this)),this},turnOffModelListeners:function(){var t=this.model||this.collection;return t&&(s.each(this.__monitors,function(e,n){t.off("change:"+n,e.fn,this)}),s.each(this.__events,function(e,n){t.off(n,e.fn,this)})),this},setupBinders:function(){var t=this.model||this.collection;return this.findThumbsBind().turnOnModelListeners(),this.__setValues(t.attributes),this},render:function(){return this._super("render",arguments),(this.model||this.collection)&&this.setupBinders(),this},remove:function(){return this.turnOffModelListeners(),this.__monitors=this.__events=null,this._super("remove",arguments)}},w={checkFormatting:function(t,n,i){var s=this.$(t),o=r(arguments);n=o.length===3?n:s.text(),n=n!==null&&"undefined"!=typeof n?n:"";var u=s.data("thumbs-format");h(u||"",function(e){e.length===2?(i=e[0],u=e[1]):u=e.pop()}),u&&"function"==typeof this[u]&&(n=this[u](n)),i?"function"==typeof s[i]?s[i](n):s.attr(i,n):s.is("input")?s.is("[type=checkbox], [type=radio]")?s.attr("checked",n):s.val(n):s.text(n)},renderFormatters:function(){var t=s.bind(this.checkFormatting,this);return this.$("[data-thumbs-format]").each(function(){t(this)}),this},render:function(){return this._super("render",arguments),this.renderFormatters()}},E={findEl:function(){var e=s.bind(this.setElement,this),t=this.$("[data-thumbs-el]").first().get();return t.length&&e(t[0]),this},render:function(){return this.findEl()._super("render",arguments)}};i.templater=function(){var t=s.template;return function(n){return n?t=n:t}}(),i.Router=l.extend({route:function(e,t,n){return this._super("route",arguments),!i.history&&(i.history=o.history),this}}),a=i.View=a.extend(E).extend(w).extend(y).extend(b).extend(g).extend({_subviews:null,initialize:function(t){this._super("initialize",arguments),this._subviews={}},addSubView:function(t,n){return this.removeSubView(t),this._subviews[t]=n,n.setElement(this.$(t)).render(),this},removeSubView:function(t){var n=this._subviews[t];return n&&(n.setElement(null),n.remove(),this.$(t).empty(),delete this._subviews[t]),this},removeSubViews:function(){return s.each(this._subviews,function(e,t){this.removeSubView(t)},this),this},render:function(){return this._super("render",arguments),this.assign(this._subviews),this},assign:function(t,n){var r;return s.isObject(t)?r=t:t&&(r={},r[t]=n),r&&s.each(r,function(e,t){e.setElement(this.$(t)).render()},this),this},remove:function(){return this.undelegateEvents(),this.removeSubViews(),this._super("remove",arguments)}}),i.TemplateView=a.extend({templater:i.templater(),template:null,initialize:function(e){this._super("initialize",arguments),this.template&&(this._template=this.templater(this.template))},getTemplateData:function(){return this.model||this.collection?(this.model||this.collection).toJSON():{}},fillTemplate:function(t){return t=t||this.getTemplateData(),this._template?this._template(t):null},renderTemplate:function(){if(this._template){var t=this.fillTemplate();t&&this.$el.html(t)}return this},render:function(){return this.renderTemplate()._super("render",arguments)}}),"undefined"!=typeof exports?"undefined"!=typeof module&&module.exports&&(module.exports=i):"function"==typeof define?define(function(){return i}):this.thumbs=i}).call(this);